# Mock Transactions API

Minimal REST API **mock** built with **.NETÂ 9Â Preview** to simulate a paymentâ€hub endpoint that lists transactions filtered by `externalReference`. It is meant for local development, automated tests and demos when the real upstream service is unavailable.

---

## Features

| Behaviour                              | Probability | Details                                                                                                     |
| -------------------------------------- | ----------- | ----------------------------------------------------------------------------------------------------------- |
| **Single _COMPLETED_ transaction**     | **70Â %**    | Returns one record with status `COMPLETED`.                                                                 |
| **Two records _PENDING_ âœ _REVERSED_** | 15Â %        | Simulates an inâ€‘flight transaction that was later reversed. First elementÂ = `PENDING`, secondÂ = `REVERSED`. |
| **HTTPÂ 500 Timeout error**             | 15Â %        | Mimics an upstream timeout, returning RFCÂ 9457 Problem+JSON.                                                |

All three scenarios are chosen randomly on each request, giving your client code or QA scripts a realistic mix of happyâ€‘path and failure conditions.

---

## ğŸš€ QuickÂ Start

### Prerequisites

- [.NETÂ 9Â SDK](https://dotnet.microsoft.com/) Preview (install via `dotnet --version`Â â†’Â `9.0.0-preview`)

### Run locally

```bash
# clone and build
 dotnet restore
 dotnet run --urls http://0.0.0.0:5000
```

> The API listens on **[http://localhost:5000](http://localhost:5000)** and automatically redirects to HTTPS on portÂ `5001` if ASP.NET devâ€‘certs are present.

### Docker

```bash
# Build image
 docker build -t mock-transactions-api .

# Run container
 docker run -p 5000:5000 mock-transactions-api
```

---

## ğŸ”Œ Endpoint reference

### `GET /transactions`

| Query parameter     | Type     | Required | Default | Description                             |
| ------------------- | -------- | -------- | ------- | --------------------------------------- |
| `externalReference` | `string` | âœ…       | â€“       | Identifier used to filter transactions. |
| `offset`            | `int`    | âŒ       | `0`     | Zeroâ€‘based index for pagination.        |
| `limit`             | `int`    | âŒ       | `100`   | Page size.                              |

#### Successful responseÂ `200 OK`

```jsonc
{
  "total": 1,
  "offset": 0,
  "limit": 100,
  "data": [
    {
      "transactionId": "d1db6b20â€‘e2e0â€‘42b7â€‘8235â€‘4245b6251f9e",
      "transactionType": "PAYMENT",
      "status": "COMPLETED",
      "externalReference": "abcâ€‘123",
      "createdAt": "2025â€‘07â€‘02T15:04:33Z",
      "completedAt": "2025â€‘07â€‘02T15:04:33Z",
      "reversedAt": null,
      "finalizedAt": null
    }
  ]
}
```

#### Error responseÂ `500 InternalÂ ServerÂ Error`

```jsonc
{
  "type": "about:blank",
  "title": "Timeout contacting upstream service",
  "status": 500,
  "detail": "The external provider did not respond within the allotted time."
}
```

---

## ğŸ› ï¸ Testing withÂ `curl`

```bash
curl -k "https://localhost:5001/transactions?externalReference=abc-123"
```

Run the command repeatedly to observe the three possible outcomes.

---

## ğŸ¤– Using Postman

1. **Create a new collection** â†’ _Mock TransactionsÂ API_.
2. Add a **GET** request to `{{base_url}}/transactions` and set query params:

   - `externalReference`Â = `abc-123`
   - `offset`Â = `0`
   - `limit`Â = `100`

3. Define an environment variable `base_url` pointing to `https://localhost:5001` (or `http://localhost:5000`).
4. Hit **Send** multiple times; Postman will show 200 or 500 responses according to the random logic.

Example test script (TestsÂ tab):

```javascript
pm.test("Valid status code", () => {
  pm.expect(pm.response.code).to.be.oneOf([200, 500]);
});
```

---

## ğŸ“œ OpenAPI & Swagger UI

- The contract is autoâ€‘generated by ASP.NETâ€™s **`AddOpenApi`**.

  - **`/openapi.json`** (or `/openapi.yaml`) â€“ machineâ€‘readable spec.

- To add SwaggerÂ UI interactively:

  ```csharp
  builder.Services.AddEndpointsApiExplorer();
  builder.Services.AddSwaggerGen();
  app.UseSwagger();
  app.UseSwaggerUI();      // now browse to /swagger
  ```

---

## ğŸ‘©â€ğŸ’» Contributing

Pull requests are welcome. Feel free to open an issue if you need other scenarios (e.g. 401, 429, network delay injectors).

---

## ğŸ“ License

Distributed under the MIT License. See `LICENSE` for more information.
